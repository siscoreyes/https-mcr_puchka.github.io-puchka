<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASIN - Portal de Manuales</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 200px;
            background: linear-gradient(135deg, #1a3a52 0%, #2a5a7a 100%);
            padding: 20px 0;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-logo {
            text-align: center;
            padding: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }

        .sidebar-logo img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            padding: 5px;
        }

        .sidebar-logo h3 {
            color: white;
            font-size: 14px;
            margin-top: 10px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin: 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background-color: rgba(255,255,255,0.1);
            color: white;
            border-left-color: #ff6b6b;
        }

        .sidebar-menu a span {
            margin-left: 10px;
            font-size: 14px;
        }

        /* Main Content */
        .main-content {
            margin-left: 200px;
            flex: 1;
            padding: 20px;
        }

        /* Header */
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            color: #1a3a52;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: #f0f0f0;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            color: #555;
        }

        /* Period Section */
        .period-section {
            margin-bottom: 40px;
        }

        .period-header {
            background: linear-gradient(135deg, #ffcccb 0%, #ffa5a5 100%);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #333;
            font-size: 18px;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .card-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #1a3a52 0%, #2a5a7a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            text-align: center;
            padding: 20px;
            font-weight: bold;
        }

        .card-content {
            padding: 15px;
        }

        .card-title {
            font-size: 14px;
            font-weight: bold;
            color: #1a3a52;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .card-meta {
            font-size: 12px;
            color: #888;
        }

        /* File Input */
        .file-input-wrapper {
            position: relative;
        }

        .file-input-wrapper input[type="file"] {
            display: none;
        }

        .file-upload-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background: #1a3a52;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
            margin-top: 10px;
        }

        .file-upload-btn:hover {
            background: #2a5a7a;
        }

        .file-status {
            font-size: 11px;
            color: #28a745;
            margin-top: 8px;
            display: none;
        }

        .file-status.show {
            display: block;
        }

        .download-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
            margin-top: 10px;
        }

        .download-btn:hover {
            background: #218838;
        }

        .clear-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
            margin-top: 5px;
        }

        .clear-btn:hover {
            background: #c82333;
        }

        /* Footer */
        .footer {
            background: white;
            padding: 20px;
            text-align: center;
            margin-top: 40px;
            border-top: 1px solid #eee;
            font-size: 12px;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                padding: 10px 0;
            }

            .sidebar-logo h3 {
                display: none;
            }

            .sidebar-menu a span {
                display: none;
            }

            .main-content {
                margin-left: 70px;
                padding: 10px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
            }

            .card-image {
                height: 120px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <svg width="130" height="130" viewBox="0 0 300 300" style="margin: 0 auto; display: block;" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <style>
                            .circular-text { font-family: 'Arial Black', Arial, sans-serif; font-weight: 900; font-size: 24px; fill: white; letter-spacing: 4px; }
                        </style>
                    </defs>
                    
                    <!-- C√≠rculo exterior azul oscuro -->
                    <circle cx="150" cy="150" r="145" fill="#1e3d5c"/>
                    
                    <!-- C√≠rculo interior crema/blanco -->
                    <circle cx="150" cy="150" r="125" fill="#f5f0e8"/>
                    
                    <!-- Banda azul claro MASIN (izquierda) -->
                    <rect x="30" y="115" width="60" height="70" fill="#5ba3d0"/>
                    <text x="60" y="160" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="white" text-anchor="middle">MASIN</text>
                    
                    <!-- Banda azul claro 1996 (derecha) -->
                    <rect x="210" y="115" width="60" height="70" fill="#5ba3d0"/>
                    <text x="240" y="160" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="white" text-anchor="middle">1996</text>
                    
                    <!-- Coraz√≥n rojo grande -->
                    <g transform="translate(150, 115)">
                        <path d="M 0 35 C -40 0 -55 -15 -55 -25 C -55 -45 -40 -55 -25 -55 C -10 -55 0 -45 0 -35 C 0 -45 10 -55 25 -55 C 40 -55 55 -45 55 -25 C 55 -15 40 0 0 35 Z" fill="#c7363a"/>
                    </g>
                    
                    <!-- Cruz blanca en el coraz√≥n -->
                    <rect x="143" y="95" width="14" height="50" fill="white" rx="2"/>
                    <rect x="123" y="115" width="54" height="14" fill="white" rx="2"/>
                    
                    <!-- Mano izquierda roja -->
                    <g>
                        <!-- Palma -->
                        <ellipse cx="95" cy="145" rx="22" ry="32" fill="#c7363a"/>
                        <!-- Pulgar -->
                        <ellipse cx="75" cy="130" rx="10" ry="15" fill="#c7363a" transform="rotate(-40 75 130)"/>
                        <!-- Dedos -->
                        <rect x="65" y="170" width="12" height="35" fill="#c7363a" rx="6"/>
                        <rect x="82" y="175" width="12" height="40" fill="#c7363a" rx="6"/>
                        <rect x="99" y="173" width="12" height="38" fill="#c7363a" rx="6"/>
                    </g>
                    
                    <!-- Mano derecha roja -->
                    <g>
                        <!-- Palma -->
                        <ellipse cx="205" cy="145" rx="22" ry="32" fill="#c7363a"/>
                        <!-- Pulgar -->
                        <ellipse cx="225" cy="130" rx="10" ry="15" fill="#c7363a" transform="rotate(40 225 130)"/>
                        <!-- Dedos -->
                        <rect x="223" y="170" width="12" height="35" fill="#c7363a" rx="6"/>
                        <rect x="206" y="175" width="12" height="40" fill="#c7363a" rx="6"/>
                        <rect x="189" y="173" width="12" height="38" fill="#c7363a" rx="6"/>
                    </g>
                    
                    <!-- Texto circular MICRORED CLAS PUCHAKA (arriba) -->
                    <path id="topPath" d="M 60 150 A 90 90 0 0 1 240 150" fill="none"/>
                    <text class="circular-text">
                        <textPath href="#topPath" startOffset="50%" text-anchor="middle" letter-spacing="3">
                            MICRORED CLAS PUCHAKA
                        </textPath>
                    </text>
                    
                    <!-- Texto circular MASIN - HUARI - ANCASH (abajo) -->
                    <path id="bottomPath" d="M 240 150 A 90 90 0 0 1 60 150" fill="none"/>
                    <text class="circular-text">
                        <textPath href="#bottomPath" startOffset="50%" text-anchor="middle" letter-spacing="3">
                            MASIN - HUARI - ANCASH
                        </textPath>
                    </text>
                </svg>
            </div>

    <!-- Modal de Alerta Bienvenida -->
    <div id="alertModal" class="alert-modal">
        <div class="alert-modal-content">
            <div class="alert-icon">üè•</div>
            <h2>Portal MASIN</h2>
            <p>Bienvenido al Portal de Manuales de la Microred Clas Puchaka. Accediendo como <strong>Usuario Libre</strong>.</p>
            <div class="alert-buttons">
                <button class="alert-btn alert-btn-primary" onclick="closeAlertModal()">Aceptar</button>
            </div>
        </div>
    </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active"><span>üè† Inicio</span></a></li>
                <li><a href="#"><span>üìã Manuales</span></a></li>
                <li><a href="#"><span>üë• Profesionales</span></a></li>
                <li><a href="#"><span>üìä Actividades</span></a></li>
                <li><a href="#"><span>‚öôÔ∏è Configuraci√≥n</span></a></li>
                <li><a href="#"><span>üìû Soporte</span></a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="header">
                <div>
                    <h1>Portal de Manuales MASIN</h1>
                </div>
                <div class="header-info">
                    <div class="user-badge">üë§ Usuario Libre</div>
                    <div class="user-badge" id="visitorCount" style="background: #e8f5e9; color: #2e7d32; font-weight: bold;">
                        üë• Visitantes: <span id="count">1</span>
                    </div>
                </div>
            </div>

            <!-- Period 2025 -->
            <div class="period-section">
                <div class="period-header">üìÖ Per√≠odo 2025</div>
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-image">üìä Manual de Prevenci√≥n y Control de Anemia</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registro y Codificaci√≥n de la Prevenci√≥n y Control de Anemia</div>
                            <div class="card-meta">Ni√±o, Ni√±a, Adolescente</div>
                            <div class="file-input-wrapper">
                                <label for="file1" class="file-upload-btn" id="label1">üì§ Subir Excel</label>
                                <input type="file" id="file1" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 1)" />
                                <div class="file-status" id="status1"></div>
                                <button class="download-btn" id="btn1" onclick="downloadFile(1)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear1" onclick="clearFile(1)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-image">üè• Manual de Actividades en Atenci√≥n</div>
                        <div class="card-content">
                            <div class="card-title">Registro y Codificaci√≥n de Actividades en la Atenci√≥n en Salud Mental</div>
                            <div class="card-meta">Promoci√≥n de la Salud</div>
                            <div class="file-input-wrapper">
                                <label for="file2" class="file-upload-btn" id="label2">üì§ Subir Excel</label>
                                <input type="file" id="file2" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 2)" />
                                <div class="file-status" id="status2"></div>
                                <button class="download-btn" id="btn2" onclick="downloadFile(2)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear2" onclick="clearFile(2)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-image">üëÅÔ∏è Manual de Salud Ocular</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registros y Codificaci√≥n de la Atenci√≥n de Salud Ocular</div>
                            <div class="card-meta">Prevenci√≥n de la Ceguera</div>
                            <div class="file-input-wrapper">
                                <label for="file3" class="file-upload-btn" id="label3">üì§ Subir Excel</label>
                                <input type="file" id="file3" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 3)" />
                                <div class="file-status" id="status3"></div>
                                <button class="download-btn" id="btn3" onclick="downloadFile(3)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear3" onclick="clearFile(3)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-image">üë¥ Manual de Adulto Mayor</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registro y Codificaci√≥n de Adulto Mayor</div>
                            <div class="card-meta">Poblaci√≥n Mayor</div>
                            <div class="file-input-wrapper">
                                <label for="file4" class="file-upload-btn" id="label4">üì§ Subir Excel</label>
                                <input type="file" id="file4" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 4)" />
                                <div class="file-status" id="status4"></div>
                                <button class="download-btn" id="btn4" onclick="downloadFile(4)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear4" onclick="clearFile(4)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-image">üéóÔ∏è Manual de Actividades Control</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registros y Codificaci√≥n de las Actividades Control de Cancer</div>
                            <div class="card-meta">2025</div>
                            <div class="file-input-wrapper">
                                <label for="file5" class="file-upload-btn" id="label5">üì§ Subir Excel</label>
                                <input type="file" id="file5" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 5)" />
                                <div class="file-status" id="status5"></div>
                                <button class="download-btn" id="btn5" onclick="downloadFile(5)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear5" onclick="clearFile(5)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-image">‚öïÔ∏è Manual de Da√±os No Transmisibles</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registro y Codificaci√≥n Da√±os No Transmisibles</div>
                            <div class="card-meta">Componente Control</div>
                            <div class="file-input-wrapper">
                                <label for="file6" class="file-upload-btn" id="label6">üì§ Subir Excel</label>
                                <input type="file" id="file6" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 6)" />
                                <div class="file-status" id="status6"></div>
                                <button class="download-btn" id="btn6" onclick="downloadFile(6)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear6" onclick="clearFile(6)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Period 2024 -->
            <div class="period-section">
                <div class="period-header">üìÖ Per√≠odo 2024</div>
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-image">üîç Manual de Promoci√≥n</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registro y Codificaci√≥n de Actividades de Promoci√≥n de la Salud</div>
                            <div class="card-meta">2024</div>
                            <div class="file-input-wrapper">
                                <label for="file7" class="file-upload-btn" id="label7">üì§ Subir Excel</label>
                                <input type="file" id="file7" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 7)" />
                                <div class="file-status" id="status7"></div>
                                <button class="download-btn" id="btn7" onclick="downloadFile(7)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear7" onclick="clearFile(7)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-image">üö® Manual de Vigilancia</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registro y Codificaci√≥n de las Actividades de Vigilancia Epidemiol√≥gica</div>
                            <div class="card-meta">Inteligencia Sanitaria</div>
                            <div class="file-input-wrapper">
                                <label for="file8" class="file-upload-btn" id="label8">üì§ Subir Excel</label>
                                <input type="file" id="file8" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 8)" />
                                <div class="file-status" id="status8"></div>
                                <button class="download-btn" id="btn8" onclick="downloadFile(8)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear8" onclick="clearFile(8)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-image">üíä Manual de Farmacoterapia</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registro y Codificaci√≥n de Actividades de Farmacoterapia</div>
                            <div class="card-meta">Medicamentos y Vacunas</div>
                            <div class="file-input-wrapper">
                                <label for="file9" class="file-upload-btn" id="label9">üì§ Subir Excel</label>
                                <input type="file" id="file9" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 9)" />
                                <div class="file-status" id="status9"></div>
                                <button class="download-btn" id="btn9" onclick="downloadFile(9)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear9" onclick="clearFile(9)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-image">üß¨ Manual de Gen√©tica Cl√≠nica</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registro y Codificaci√≥n de Enfermedades Gen√©ticas Cl√≠nicas</div>
                            <div class="card-meta">Patolog√≠a Cl√≠nica</div>
                            <div class="file-input-wrapper">
                                <label for="file10" class="file-upload-btn" id="label10">üì§ Subir Excel</label>
                                <input type="file" id="file10" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 10)" />
                                <div class="file-status" id="status10"></div>
                                <button class="download-btn" id="btn10" onclick="downloadFile(10)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear10" onclick="clearFile(10)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-image">üè• Manual de Hospitalizaci√≥n</div>
                        <div class="card-content">
                            <div class="card-title">Manual de Registro y Codificaci√≥n de Servicios de Hospitalizaci√≥n</div>
                            <div class="card-meta">Internamiento y Cirug√≠a</div>
                            <div class="file-input-wrapper">
                                <label for="file11" class="file-upload-btn" id="label11">üì§ Subir Excel</label>
                                <input type="file" id="file11" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this, 11)" />
                                <div class="file-status" id="status11"></div>
                                <button class="download-btn" id="btn11" onclick="downloadFile(11)" style="display:none;">‚¨áÔ∏è Descargar</button>
                                <button class="clear-btn" id="clear11" onclick="clearFile(11)" style="display:none;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <p>¬© 2025. Todos los derechos reservados. | MASIN - Microred Clas Puchaka</p>
            </div>
        </main>
    </div>

    <script>
        // Almacenamiento de archivos usando IndexedDB
        const files = {};
        let db;

        // Inicializar IndexedDB
        function initDB() {
            loadFilesFromStorage();
        }

        function saveFile(cardId, file) {
            const reader = new FileReader();
            reader.onload = async (e) => {
                const fileData = {
                    cardId: cardId,
                    name: file.name,
                    data: e.target.result,
                    type: file.type
                };
                
                try {
                    // Guardar en window.storage
                    await window.storage.set('file_' + cardId, JSON.stringify(fileData));
                    files[cardId] = { name: file.name, data: e.target.result };
                    updateUI(cardId);
                } catch (err) {
                    console.error('Error al guardar:', err);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function loadAllFiles() {
            // Cargar archivos guardados de window.storage
            loadFilesFromStorage();
        }

        async function loadFilesFromStorage() {
            try {
                const result = await window.storage.list('file_');
                if (result && result.keys) {
                    for (let key of result.keys) {
                        const fileData = await window.storage.get(key);
                        if (fileData && fileData.value) {
                            const data = JSON.parse(fileData.value);
                            files[data.cardId] = { 
                                name: data.name, 
                                data: new Uint8Array(data.data).buffer
                            };
                            updateUI(data.cardId);
                        }
                    }
                }
            } catch (err) {
                console.error('Error al cargar archivos:', err);
            }
        }

        function updateUI(cardId) {
            const statusDiv = document.getElementById('status' + cardId);
            const downloadBtn = document.getElementById('btn' + cardId);
            const uploadLabel = document.getElementById('label' + cardId);
            const clearBtn = document.getElementById('clear' + cardId);
            
            if (files[cardId]) {
                statusDiv.textContent = '‚úÖ ' + files[cardId].name + ' cargado';
                statusDiv.classList.add('show');
                downloadBtn.style.display = 'block';
                clearBtn.style.display = 'block';
                uploadLabel.style.display = 'none';
            }
        }

        function handleFileUpload(input, cardId) {
            const file = input.files[0];
            if (file) {
                const validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 
                                  'application/vnd.ms-excel', 'text/csv'];
                if (validTypes.includes(file.type) || 
                    file.name.endsWith('.xlsx') || 
                    file.name.endsWith('.xls') || 
                    file.name.endsWith('.csv')) {
                    
                    saveFile(cardId, file);
                    input.disabled = true;
                } else {
                    alert('‚ö†Ô∏è Por favor selecciona un archivo Excel v√°lido (.xlsx, .xls o .csv)');
                    input.value = '';
                }
            }
        }

        function downloadFile(cardId) {
            if (files[cardId]) {
                const fileData = files[cardId];
                const blob = new Blob([fileData.data]);
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileData.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        function clearFile(cardId) {
            if (confirm('¬øEst√°s seguro de que deseas eliminar este archivo?')) {
                try {
                    window.storage.delete('file_' + cardId);
                    delete files[cardId];
                    
                    const statusDiv = document.getElementById('status' + cardId);
                    const downloadBtn = document.getElementById('btn' + cardId);
                    const uploadLabel = document.getElementById('label' + cardId);
                    const fileInput = document.getElementById('file' + cardId);
                    const clearBtn = document.getElementById('clear' + cardId);
                    
                    statusDiv.textContent = '';
                    statusDiv.classList.remove('show');
                    downloadBtn.style.display = 'none';
                    uploadLabel.style.display = 'block';
                    clearBtn.style.display = 'none';
                    fileInput.disabled = false;
                    fileInput.value = '';
                } catch (err) {
                    console.error('Error al eliminar:', err);
                }
            }
        }

        // Inicializar cuando carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            initDB();
            initVisitors();
        });

        function showAlertModal() {
        }

        function closeAlertModal() {
        }

        function handleLogin() {
        }

        // Sistema de Visitantes
        let visitorsCount = 1;

        function initVisitors() {
            // Usar sessionStorage en lugar de localStorage
            const stored = sessionStorage.getItem('masinVisitors');
            if (stored) {
                visitorsCount = parseInt(stored) + 1;
            }
            sessionStorage.setItem('masinVisitors', visitorsCount);
            updateVisitorDisplay();

            // Simular visitantes activos (disminuye despu√©s de 5 minutos de inactividad)
            setInterval(() => {
                if (visitorsCount > 1 && Math.random() > 0.95) {
                    visitorsCount--;
                    sessionStorage.setItem('masinVisitors', visitorsCount);
                    updateVisitorDisplay();
                }
            }, 30000);

            // Actualizar cada 5 segundos
            setInterval(updateVisitorDisplay, 5000);
        }

        function updateVisitorDisplay() {
            const countElement = document.getElementById('count');
            if (countElement) {
                countElement.textContent = visitorsCount;
            }
        }

        // Cuando el usuario cierre la pesta√±a, reducir visitantes
        window.addEventListener('beforeunload', () => {
            if (visitorsCount > 1) {
                visitorsCount--;
                sessionStorage.setItem('masinVisitors', visitorsCount);
            } else {
                sessionStorage.removeItem('masinVisitors');
            }
        });

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            const modal = document.getElementById('alertModal');
            if (event.target === modal) {
                closeAlertModal();
            }
        }
    </script>
</body>
</html>
